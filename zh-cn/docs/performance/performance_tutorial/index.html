<!doctype html>
<html lang="zh-cn" dir="ltr" class="docs-wrapper docs-doc-page docs-version-1.1.0 plugin-docs plugin-id-default docs-doc-id-performance/performance_tutorial">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">基准测试教程 | Apache YuniKorn</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yunikorn.apache.org/zh-cn/img/logo/yunikorn-logo-main.png"><meta data-rh="true" name="twitter:image" content="https://yunikorn.apache.org/zh-cn/img/logo/yunikorn-logo-main.png"><meta data-rh="true" property="og:url" content="https://yunikorn.apache.org/zh-cn/docs/performance/performance_tutorial"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="docusaurus_version" content="1.1.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.1.0"><meta data-rh="true" name="docsearch:version" content="1.1.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.1.0"><meta data-rh="true" property="og:title" content="基准测试教程 | Apache YuniKorn"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><meta data-rh="true" name="keywords" content="性能,教程"><link data-rh="true" rel="icon" href="/zh-cn/img/yunikorn.ico"><link data-rh="true" rel="canonical" href="https://yunikorn.apache.org/zh-cn/docs/performance/performance_tutorial"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/performance/performance_tutorial" hreflang="en"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/zh-cn/docs/performance/performance_tutorial" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/performance/performance_tutorial" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Q1V951BG2V-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Apache YuniKorn" href="/zh-cn/opensearch.xml"><link rel="stylesheet" href="/zh-cn/assets/css/styles.1e6e3144.css">
<link rel="preload" href="/zh-cn/assets/js/runtime~main.bdaf632d.js" as="script">
<link rel="preload" href="/zh-cn/assets/js/main.f4f57a7e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">1.1.0 has been released, check the DOWNLOADS</div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-cn/"><div class="navbar__logo"><img src="/zh-cn/img/logo/yunikorn_blue_logo.png" alt="YuniKorn Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-cn/img/logo/yunikorn_white_logo.png" alt="YuniKorn Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Apache YuniKorn</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-cn/docs/">快速开始</a><a class="navbar__item navbar__link" href="/zh-cn/community/roadmap">路线图</a><a class="navbar__item navbar__link" href="/zh-cn/community/download">下载</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">社区</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-cn/community/get_involved">进行参与</a></li><li><a class="dropdown__link" href="/zh-cn/community/how_to_contribute">如何贡献</a></li><li><a class="dropdown__link" href="/zh-cn/community/coding_guidelines">编码指南</a></li><li><a class="dropdown__link" href="/zh-cn/community/reporting_issues">报告问题</a></li><li><a class="dropdown__link" href="/zh-cn/community/release_procedure">发布流程</a></li><li><a class="dropdown__link" href="/zh-cn/community/events">事件</a></li><li><a class="dropdown__link" href="/zh-cn/community/people">人员</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache软件基金会<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">事件<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">赞助商<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">赞助<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy Policy<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-cn/docs">文档</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-cn/docs/next/">Master</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh-cn/docs/">1.1.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/1.0.0/">1.0.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.12.2/">0.12.2</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.12.1/">0.12.1</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.11.0/">0.11.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.10.0/">0.10.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.9.0/">0.9.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.8.0/">0.8.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/docs/performance/performance_tutorial" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-cn/docs/performance/performance_tutorial" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-cn">中文</a></li></ul></div><a href="https://github.com/apache/yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-cn/docs/">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-cn/docs/user_guide/deployment_modes">User Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-cn/docs/developer_guide/env_setup">Developer Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh-cn/docs/performance/evaluate_perf_function_with_kubemark">Performance</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/performance/evaluate_perf_function_with_kubemark">使用 Kubemark 评估 YuniKorn 的性能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-cn/docs/performance/performance_tutorial">基准测试教程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/performance/metrics">调度程序指标</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/performance/profiling">分析</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Performance</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">基准测试教程</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：1.1.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>基准测试教程</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a class="hash-link" href="#概述" title="标题的直接链接">​</a></h2><p>YuniKorn社区不断优化调度器的性能，确保YuniKorn满足大规模批处理工作负载的性能要求。 因此，社区为性能基准测试构建了一些有用的工具，可以跨版本重用。 本文档介绍了所有这些工具和运行它们的步骤。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="硬件">硬件<a class="hash-link" href="#硬件" title="标题的直接链接">​</a></h2><p>请注意，性能结果因底层硬件而异。 文档中发布的所有结果只能作为参考。 我们鼓励每个人在自己的环境中运行类似的测试，以便根据您自己的硬件获得结果。 本文档仅用于演示目的。</p><p>本次测试中使用的服务器列表是（非常感谢<a href="http://www.ntcu.edu.tw/newweb/index.htm" target="_blank" rel="noopener noreferrer">国立台中教育大学</a>, <a href="http://www.ntcu.edu.tw/kclai/" target="_blank" rel="noopener noreferrer">Kuan-Chou Lai</a> 为运行测试提供这些服务器):</p><table><thead><tr><th>机型</th><th>CPU</th><th>内存</th><th>下载/上传(Mbps)</th></tr></thead><tbody><tr><td>HP</td><td>16</td><td>36G</td><td>525.74/509.86</td></tr><tr><td>HP</td><td>16</td><td>30G</td><td>564.84/461.82</td></tr><tr><td>HP</td><td>16</td><td>30G</td><td>431.06/511.69</td></tr><tr><td>HP</td><td>24</td><td>32G</td><td>577.31/576.21</td></tr><tr><td>IBM blade H22</td><td>16</td><td>38G</td><td>432.11/4.15</td></tr><tr><td>IBM blade H22</td><td>16</td><td>36G</td><td>714.84/4.14</td></tr><tr><td>IBM blade H22</td><td>16</td><td>42G</td><td>458.38/4.13</td></tr><tr><td>IBM blade H22</td><td>16</td><td>42G</td><td>445.42/4.13</td></tr><tr><td>IBM blade H22</td><td>16</td><td>32G</td><td>400.59/4.13</td></tr><tr><td>IBM blade H22</td><td>16</td><td>12G</td><td>499.87/4.13</td></tr><tr><td>IBM blade H23</td><td>8</td><td>32G</td><td>468.51/4.14</td></tr><tr><td>WS660T</td><td>8</td><td>16G</td><td>87.73/86.30</td></tr><tr><td>ASUSPRO D640MB_M640SA</td><td>4</td><td>8G</td><td>92.43/93.77</td></tr><tr><td>PRO E500 G6_WS720T</td><td>16</td><td>8G</td><td>90/87.18</td></tr><tr><td>WS E500 G6_WS720T</td><td>8</td><td>40G</td><td>92.61/89.78</td></tr><tr><td>E500 G5</td><td>8</td><td>8G</td><td>91.34/85.84</td></tr><tr><td>WS E500 G5_WS690T</td><td>12</td><td>16G</td><td>92.2/93.76</td></tr><tr><td>WS E500 G5_WS690T</td><td>8</td><td>32G</td><td>91/89.41</td></tr><tr><td>WS E900 G4_SW980T</td><td>80</td><td>512G</td><td>89.24/87.97</td></tr></tbody></table><p>每个服务器都需要执行以下步骤，否则由于用户/进程/打开文件的数量有限，大规模测试可能会失败。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-设置etcsysctlconf">1. 设置/etc/sysctl.conf<a class="hash-link" href="#1-设置etcsysctlconf" title="标题的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kernel.pid_max=400000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fs.inotify.max_user_instances=50000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fs.inotify.max_user_watches=52094</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-设置etcsecuritylimitsconf">2. 设置/etc/security/limits.conf<a class="hash-link" href="#2-设置etcsecuritylimitsconf" title="标题的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">* soft nproc 4000000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">* hard nproc 4000000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root soft nproc 4000000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root hard nproc 4000000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">* soft nofile 50000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">* hard nofile 50000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root soft nofile 50000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root hard nofile 50000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="部署工作流">部署工作流<a class="hash-link" href="#部署工作流" title="标题的直接链接">​</a></h2><p>在进入细节之前，这里是我们测试中使用的一般步骤：</p><ul><li><a href="#Kubernetes">步骤 1</a>: 正确配置Kubernetes API服务器和控制器管理器，然后添加工作节点。</li><li><a href="#Setup-Kubemark">步骤 2</a>: 部署空pod，将模拟工作节点，命名空节点。 在所有空节点都处于就绪状态后，我们需要封锁(cordon)所有本地节点，这些本地节点是集群中的物理存在，而不是模拟节点，以避免我们将测试工作负载 pod 分配给本地节点。</li><li><a href="#Deploy-YuniKorn">步骤 3</a>: 在主节点上使用Helm chart部署YuniKorn，并将 Deployment 缩减为 0 副本，并在<code>prometheus.yml</code>中 <a href="#Setup-Prometheus">修改端口</a> 以匹配服务的端口。</li><li><a href="#Run-tests">步骤 4</a>: 部署50k Nginx pod进行测试，API服务器将创建它们。 但是由于YuniKorn调度程序Deployment已经被缩减到0个副本，所有的Nginx pod都将停留在等待状态。</li><li><a href="/zh-cn/docs/user_guide/trouble_shooting#restart-the-scheduler">步骤 5</a>: 将YuniKorn部署扩展回1个副本，并封锁主节点以避免YuniKorn 在那里分配Nginx pod。 在这一步中，YuniKorn将开始收集指标。</li><li><a href="#Collect-and-Observe-YuniKorn-metrics">步骤 6</a>: 观察Prometheus UI中公开的指标。</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="设置-kubemark">设置 Kubemark<a class="hash-link" href="#设置-kubemark" title="标题的直接链接">​</a></h2><p><a href="https://github.com/kubernetes/kubernetes/tree/master/test/kubemark" target="_blank" rel="noopener noreferrer">Kubemark</a>是一个性能测试工具，允许用户在模拟集群上运行实验。 主要用例是可扩展性测试。 基本思想是在一个物理节点上运行数十或数百个假kubelet节点，以模拟大规模集群。 在我们的测试中，我们利用 Kubemark 在少于20个物理节点上模拟多达4K节点的集群。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-构建镜像">1. 构建镜像<a class="hash-link" href="#1-构建镜像" title="标题的直接链接">​</a></h3><h5 class="anchor anchorWithStickyNavbar_LWe7" id="克隆kubernetes仓库并构建kubemark二进制文件">克隆kubernetes仓库，并构建kubemark二进制文件<a class="hash-link" href="#克隆kubernetes仓库并构建kubemark二进制文件" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/kubernetes/kubernetes.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd kubernetes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">KUBE_BUILD_PLATFORMS=linux/amd64 make kubemark GOFLAGS=-v GOGCFLAGS=&quot;-N -l&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="将kubemark二进制文件复制到镜像文件夹并构建kubemark-docker镜像">将kubemark二进制文件复制到镜像文件夹并构建kubemark docker镜像<a class="hash-link" href="#将kubemark二进制文件复制到镜像文件夹并构建kubemark-docker镜像" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp _output/bin/kubemark cluster/images/kubemark</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">IMAGE_TAG=v1.XX.X make build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完成此步骤后，您可以获得可以模拟集群节点的kubemark镜像。 您可以将其上传到Docker-Hub或仅在本地部署。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-安装kubermark">2. 安装Kubermark<a class="hash-link" href="#2-安装kubermark" title="标题的直接链接">​</a></h3><h5 class="anchor anchorWithStickyNavbar_LWe7" id="创建kubemark命名空间">创建kubemark命名空间<a class="hash-link" href="#创建kubemark命名空间" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create ns kubemark</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="创建configmap">创建configmap<a class="hash-link" href="#创建configmap" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create configmap node-configmap -n kubemark --from-literal=content.type=&quot;test-cluster&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="创建secret">创建secret<a class="hash-link" href="#创建secret" title="标题的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create secret generic kubeconfig --type=Opaque --namespace=kubemark --from-file=kubelet.kubeconfig={kubeconfig_file_path} --from-file=kubeproxy.kubeconfig={kubeconfig_file_path}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-标签节点">3. 标签节点<a class="hash-link" href="#3-标签节点" title="标题的直接链接">​</a></h3><p>我们需要给所有的原生节点打上标签，否则调度器可能会将空pod分配给其他模拟的空节点。 我们可以利用yaml中的节点选择器将空pod分配给本地节点。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl label node {node name} tag=tagName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-部署kubemark">4. 部署Kubemark<a class="hash-link" href="#4-部署kubemark" title="标题的直接链接">​</a></h3><p>hollow-node.yaml如下所示，我们可以配置一些参数。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ReplicationController</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: hollow-node</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  namespace: kubemark</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  replicas: 2000  # 要模拟的节点数</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      name: hollow-node</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name: hollow-node</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      nodeSelector:  # 利用标签分配给本地节点</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tag: tagName  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      initContainers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - name: init-inotify-limit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        image: docker.io/busybox:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        command: [&#x27;sysctl&#x27;, &#x27;-w&#x27;, &#x27;fs.inotify.max_user_instances=200&#x27;] # 设置为与实际节点中的max_user_instance相同</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        securityContext:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          privileged: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - name: kubeconfig-volume</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        secret:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          secretName: kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - name: logs-volume</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hostPath:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          path: /var/log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - name: hollow-kubelet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        image: 0yukali0/kubemark:1.20.10 # 您构建的kubemark映像 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - containerPort: 4194</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - containerPort: 10250</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - containerPort: 10255</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: NODE_NAME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          valueFrom:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            fieldRef:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              fieldPath: metadata.name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        command:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - /kubemark</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        args:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --morph=kubelet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --name=$(NODE_NAME)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --kubeconfig=/kubeconfig/kubelet.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --alsologtostderr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --v=2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: kubeconfig-volume</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          mountPath: /kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          readOnly: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: logs-volume</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          mountPath: /var/log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          requests:    # 空pod的资源，可以修改。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            cpu: 20m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            memory: 50M</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        securityContext:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          privileged: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - name: hollow-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        image: 0yukali0/kubemark:1.20.10 # 您构建的kubemark映像 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: NODE_NAME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          valueFrom:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            fieldRef:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              fieldPath: metadata.name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        command:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - /kubemark</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        args:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --morph=proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --name=$(NODE_NAME)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --use-real-proxier=false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --kubeconfig=/kubeconfig/kubeproxy.kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --alsologtostderr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - --v=2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: kubeconfig-volume</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          mountPath: /kubeconfig</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          readOnly: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: logs-volume</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          mountPath: /var/log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        resources:  # 空pod的资源，可以修改。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          requests:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            cpu: 20m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            memory: 50M</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      tolerations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - effect: NoExecute</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        key: node.kubernetes.io/unreachable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        operator: Exists</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - effect: NoExecute</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        key: node.kubernetes.io/not-ready</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        operator: Exists</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完成编辑后，将其应用于集群：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f hollow-node.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="部署-yunikorn">部署 YuniKorn<a class="hash-link" href="#部署-yunikorn" title="标题的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用helm安装yunikorn">使用helm安装YuniKorn<a class="hash-link" href="#使用helm安装yunikorn" title="标题的直接链接">​</a></h4><p>我们可以用 Helm 安装 YuniKorn，请参考这个<a href="https://yunikorn.apache.org/docs/#install" target="_blank" rel="noopener noreferrer">文档</a>。 我们需要根据默认配置调整一些参数。 我们建议克隆<a href="https://github.com/apache/yunikorn-release" target="_blank" rel="noopener noreferrer">发布仓库</a>并修改<code>value.yaml</code>中的参数。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/apache/yunikorn-release.git</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd helm-charts/yunikorn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置">配置<a class="hash-link" href="#配置" title="标题的直接链接">​</a></h4><p><code>value.yaml</code>中的修改是：</p><ul><li>增加调度程序 pod 的内存/cpu 资源</li><li>禁用 admission controller</li><li>将应用排序策略设置为 FAIR</li></ul><p>请参阅以下更改：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  requests:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cpu: 14</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory: 16Gi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  limits:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cpu: 14</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory: 16Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedAdmissionController: false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">configuration: |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  partitions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      name: default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      queues:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: root</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          submitacl: &#x27;*&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          queues:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              name: sandbox</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              properties:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                application.sort.policy: fair</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用本地版本库安装yunikorn">使用本地版本库安装YuniKorn<a class="hash-link" href="#使用本地版本库安装yunikorn" title="标题的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Helm install yunikorn . --namespace yunikorn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="设置prometheus">设置Prometheus<a class="hash-link" href="#设置prometheus" title="标题的直接链接">​</a></h2><p>YuniKorn通过Prometheus公开其调度指标。 因此，我们需要设置一个Prometheus服务器来收集这些指标。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-下载prometheus版本">1. 下载Prometheus版本<a class="hash-link" href="#1-下载prometheus版本" title="标题的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">wget https://github.com/prometheus/prometheus/releases/download/v2.30.3/prometheus-2.30.3.linux-amd64.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar xvfz prometheus-*.tar.gz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd prometheus-*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-配置prometheusyml">2. 配置prometheus.yml<a class="hash-link" href="#2-配置prometheusyml" title="标题的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">global:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  scrape_interval:     3s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  evaluation_interval: 15s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">scrape_configs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - job_name: &#x27;yunikorn&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scrape_interval: 1s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metrics_path: &#x27;/ws/v1/metrics&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    static_configs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - targets: [&#x27;docker.for.mac.host.internal:9080&#x27;] </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # 9080为内部端口，需要端口转发或修改9080为服务端口</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-启动prometheus">3. 启动Prometheus<a class="hash-link" href="#3-启动prometheus" title="标题的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./prometheus --config.file=prometheus.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>设置环境后，您就可以运行工作负载并收集结果了。 YuniKorn社区有一些有用的工具来运行工作负载和收集指标，更多详细信息将在此处发布。</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="收集和观察yunikorn指标">收集和观察YuniKorn指标<a class="hash-link" href="#收集和观察yunikorn指标" title="标题的直接链接">​</a></h2><p>Prometheus 启动后，可以轻松收集 YuniKorn 指标。 这是 YuniKorn 指标的<a href="/zh-cn/docs/performance/metrics">文档</a>。 YuniKorn 跟踪一些关键调度指标，这些指标衡量一些关键调度路径的延迟。 这些指标包括：</p><ul><li><strong>scheduling_latency_seconds:</strong> 主调度例程的延迟，以秒为单位。</li><li><strong>app_sorting_latency_seconds</strong>: 所有应用程序排序的延迟，以秒为单位。</li><li><strong>node_sorting_latency_seconds</strong>: 所有节点排序的延迟，以秒为单位。</li><li><strong>queue_sorting_latency_seconds</strong>: 所有队列排序的延迟，以秒为单位。</li><li><strong>container_allocation_attempt_total</strong>: 尝试分配容器的总次数。 尝试状态包括 <code>allocated</code>、<code>rejected</code>、<code>error</code>、<code>released</code>。 该指标仅增加。</li></ul><p>您可以在Prometheus UI上轻松选择和生成图形，例如：</p><p><img loading="lazy" alt="Prometheus Metrics List" src="/zh-cn/assets/images/prometheus-3765d2ddd0d81ce31bc9c0d44046aac6.png" width="1189" height="640" class="img_ev3q"></p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="性能调优">性能调优<a class="hash-link" href="#性能调优" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes">Kubernetes<a class="hash-link" href="#kubernetes" title="标题的直接链接">​</a></h3><p>默认的 K8s 设置限制了并发请求，这限制了集群的整体吞吐量。 在本节中，我们介绍了一些需要调整的参数，以提高集群的整体吞吐量。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kubeadm">kubeadm<a class="hash-link" href="#kubeadm" title="标题的直接链接">​</a></h4><p>设置pod网络掩码</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubeadm init --pod-network-cidr=10.244.0.0/8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cni">CNI<a class="hash-link" href="#cni" title="标题的直接链接">​</a></h4><p>修改CNI掩码和资源。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  net-conf.json: |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;Network&quot;: &quot;10.244.0.0/8&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;Backend&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;Type&quot;: &quot;vxlan&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      cpu: &quot;100m&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      memory: &quot;200Mi&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    limits:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      cpu: &quot;100m&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      memory: &quot;200Mi&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-server">Api-Server<a class="hash-link" href="#api-server" title="标题的直接链接">​</a></h4><p>在 Kubernetes API 服务器中，我们需要修改两个参数：<code>max-mutating-requests-inflight</code>和<code>max-requests-inflight</code>。 这两个参数代表API请求带宽。 因为我们会产生大量的Pod请求，所以我们需要增加这两个参数。修改<code>/etc/kubernetes/manifest/kube-apiserver.yaml</code>：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">--max-mutating-requests-inflight=3000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--max-requests-inflight=3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="controller-manager">Controller-Manager<a class="hash-link" href="#controller-manager" title="标题的直接链接">​</a></h4><p>在Kubernetes控制器管理器中，我们需要增加三个参数的值：<code>node-cidr-mask-size</code>、<code>kube-api-burst</code> <code>kube-api-qps</code>. <code>kube-api-burst</code>和<code>kube-api-qps</code>控制服务器端请求带宽。<code>node-cidr-mask-size</code>表示节点 CIDR。 为了扩展到数千个节点，它也需要增加。</p><p>Modify <code>/etc/kubernetes/manifest/kube-controller-manager.yaml</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">--node-cidr-mask-size=21 //log2(集群中的最大pod数)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--kube-api-burst=3000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--kube-api-qps=3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kubelet">kubelet<a class="hash-link" href="#kubelet" title="标题的直接链接">​</a></h4><p>在单个工作节点中，我们可以默认运行110个pod。 但是为了获得更高的节点资源利用率，我们需要在Kubelet启动命令中添加一些参数，然后重启它。</p><p>修改<code>/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code>中的起始参数，在起始参数后面添加<code>--max-Pods=300</code>并重启。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl restart kubelet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概括">概括<a class="hash-link" href="#概括" title="标题的直接链接">​</a></h2><p>借助Kubemark和Prometheus，我们可以轻松运行基准测试、收集YuniKorn指标并分析性能。 这有助于我们识别调度程序中的性能瓶颈并进一步消除它们。 YuniKorn社区未来将继续改进这些工具，并继续获得更多的性能改进。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-cn/docs/performance/evaluate_perf_function_with_kubemark"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">使用 Kubemark 评估 YuniKorn 的性能</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-cn/docs/performance/metrics"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">调度程序指标</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#硬件" class="table-of-contents__link toc-highlight">硬件</a><ul><li><a href="#1-设置etcsysctlconf" class="table-of-contents__link toc-highlight">1. 设置/etc/sysctl.conf</a></li><li><a href="#2-设置etcsecuritylimitsconf" class="table-of-contents__link toc-highlight">2. 设置/etc/security/limits.conf</a></li></ul></li><li><a href="#部署工作流" class="table-of-contents__link toc-highlight">部署工作流</a></li><li><a href="#设置-kubemark" class="table-of-contents__link toc-highlight">设置 Kubemark</a><ul><li><a href="#1-构建镜像" class="table-of-contents__link toc-highlight">1. 构建镜像</a></li><li><a href="#2-安装kubermark" class="table-of-contents__link toc-highlight">2. 安装Kubermark</a></li><li><a href="#3-标签节点" class="table-of-contents__link toc-highlight">3. 标签节点</a></li><li><a href="#4-部署kubemark" class="table-of-contents__link toc-highlight">4. 部署Kubemark</a></li></ul></li><li><a href="#部署-yunikorn" class="table-of-contents__link toc-highlight">部署 YuniKorn</a></li><li><a href="#设置prometheus" class="table-of-contents__link toc-highlight">设置Prometheus</a><ul><li><a href="#1-下载prometheus版本" class="table-of-contents__link toc-highlight">1. 下载Prometheus版本</a></li><li><a href="#2-配置prometheusyml" class="table-of-contents__link toc-highlight">2. 配置prometheus.yml</a></li><li><a href="#3-启动prometheus" class="table-of-contents__link toc-highlight">3. 启动Prometheus</a></li></ul></li><li><a href="#运行测试" class="table-of-contents__link toc-highlight">运行测试</a></li><li><a href="#收集和观察yunikorn指标" class="table-of-contents__link toc-highlight">收集和观察YuniKorn指标</a></li><li><a href="#性能调优" class="table-of-contents__link toc-highlight">性能调优</a><ul><li><a href="#kubernetes" class="table-of-contents__link toc-highlight">Kubernetes</a></li></ul></li><li><a href="#概括" class="table-of-contents__link toc-highlight">概括</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">博客</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.cloudera.com/spark-on-kubernetes-gang-scheduling-with-yunikorn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spark on Kubernetes – Gang Scheduling with YuniKorn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">代码库</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Core scheduler<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes shim<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scheduler Interface<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">WEB application<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-cn/community/get_involved">参与</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-cn/docs/performance/community/people">人们</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
<div style="font-size: 70%">
Copyright © 2020-2023 <a href="https://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
<p>The Apache Software Foundation Apache YuniKorn, YuniKorn, Apache, the Apache feather, and the Apache YuniKorn project logo are either registered trademarks or trademarks of the Apache Software Foundation.</p>
</div>
</div></div></div></div></footer></div>
<script src="/zh-cn/assets/js/runtime~main.bdaf632d.js"></script>
<script src="/zh-cn/assets/js/main.f4f57a7e.js"></script>
</body>
</html>